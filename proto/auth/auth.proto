// Версия ProtoBuf
syntax = "proto3";

// Настройки для генерации Go кода.
option go_package = "rautaruukkipalich.auth_grpc.v1;auth_grpc_v1";

service AuthService {
    rpc Register (RegisterRequest) returns (RegisterResponse);
    rpc Login (LoginRequest) returns (LoginResponse);
    rpc ChangePassword (ChangePasswordRequest) returns (ChangePasswordResponse);
    rpc ChangeUsername (ChangeUsernameRequest) returns (ChangeUsernameResponse);
    rpc Me (MeRequest) returns (MeResponse);
};

// HELPERS

// Структура User
message User {
    int32 id = 1;
    string username = 2;
    // string createdAt = 3;
    // string lastPasswordChange = 4;
    // string lastUsernameChange = 5;
    // string lastLogin = 6;
}

// Структура Error
message Error {
    int32 code = 1;
    string error = 2;
}


// Объект, который отправляется при вызове RPC-метода (ручки) Register.
message RegisterRequest {
    string username = 1;
    string password = 2;
}

// Объект, который получаем при вызове RPC-метода (ручки) Register.
message RegisterResponse {
    bool success = 1;
    optional Error error = 2;
}

message LoginRequest {
    string username = 1;
    string password = 2;
}

message LoginResponse {
    string token = 1;
    optional Error error = 2;
}

message ChangePasswordRequest {
    string token = 1;
    string oldPassword = 2;
    string newPassword = 3;
}

message ChangePasswordResponse {
    bool success = 1;
    optional Error error = 2;
}

message ChangeUsernameRequest {
    string token = 1;
    string username = 2;
}

message ChangeUsernameResponse {
    bool success = 1;
    optional Error error = 2;
}

message MeRequest {
    string token = 1;
}

message MeResponse {
    User user = 1;
    optional Error error = 2;
}